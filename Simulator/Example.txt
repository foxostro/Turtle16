# let kSerialInterface = 6
# let kIORegister = 0
# let kStatusRegister = 1

LI D, 6 # kSerialInterface
LI P, 'H'

LI D, 6 # kSerialInterface
LI P, 'e'

LI D, 6 # kSerialInterface
LI P, 'l'

LI D, 6 # kSerialInterface
LI P, 'l'

LI D, 6 # kSerialInterface
LI P, 'o'

LI D, 6 # kSerialInterface
LI P, ','

LI D, 6 # kSerialInterface
LI P, ' '

LI D, 6 # kSerialInterface
LI P, 'W'

LI D, 6 # kSerialInterface
LI P, 'o'

LI D, 6 # kSerialInterface
LI P, 'r'

LI D, 6 # kSerialInterface
LI P, 'l'

LI D, 6 # kSerialInterface
LI P, 'd'

LI D, 6 # kSerialInterface
LI P, '!'

beginningOfInputLoop:

LXY waitForInput
JALR waitForInput

# Read a byte and echo it back.
LI D, 6 # kSerialInterface
LI Y, 0 # kIORegister
MOV A, P
MOV P, A

LXY beginningOfInputLoop
JMP
HLT




waitForInput:

# Wait until the number of available bytes is greater than zero.
loop:
LI D, 6 # kSerialInterface
LI Y, 1 # kStatusRegister
MOV B, P
LI A, 1
CMP
LXY loop
JC

# Return from the function.
MOV X, G
MOV Y, H
JMP
